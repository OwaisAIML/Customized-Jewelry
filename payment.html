<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pay ‚Äî Customised Jewellary</title>
  <meta name="description" content="Secure UPI Payment for Customised Jewellary" />

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #fff5f7;
    }
  </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

  <main class="w-full max-w-xl bg-white rounded-2xl shadow-xl border border-rose-100">
    
    <!-- HEADER -->
    <header class="p-5 border-b border-gray-200">
      <h1 class="text-lg font-semibold">Complete Payment</h1>
      <p class="text-sm text-gray-500">
        Pay securely via any UPI app (Google Pay, PhonePe, Paytm‚Ä¶)
      </p>
    </header>

    <!-- CONTENT -->
    <section class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <!-- LEFT SIDE: QR + UPI -->
      <div class="text-center">
        <img src="images/Gpay Scanner Toyiba.jpg"
             class="w-52 h-52 rounded-xl shadow-md mx-auto object-cover"
             alt="UPI QR Code">

        <button id="copyBtn"
                class="mt-4 w-full bg-rose-600 hover:bg-rose-700 text-white font-semibold text-sm p-3 rounded-xl">
          Copy UPI ID
        </button>

        <p class="mt-2 text-xs text-gray-600">
          UPI ID: <span class="font-mono font-semibold" id="upiDisplay">Aroobakhan660@okicici</span>
        </p>

        <p class="mt-3 text-xs text-gray-500">
          If payment doesn‚Äôt open, scan the QR or use the copied UPI ID.
        </p>
      </div>

      <!-- RIGHT SIDE: Details + Pay + WhatsApp -->
      <div>
        <p class="text-xs text-gray-500">Product</p>
        <p id="prodName" class="text-base font-semibold mt-1">Product</p>

        <p class="mt-4 text-xs text-gray-500">Amount</p>
        <p id="prodPrice" class="text-2xl font-semibold">‚Çπ0.00</p>

        <p id="amountNote" class="text-xs text-gray-500"></p>

        <!-- Pay button -->
        <button id="payBtn"
                class="mt-4 w-full bg-rose-600 hover:bg-rose-700 text-white font-semibold text-sm p-3 rounded-xl">
          Pay with UPI App
        </button>

        <!-- UPI backup link -->
        <a id="upiLink"
           href="#"
           class="mt-2 block text-center text-blue-600 underline text-xs break-all">
        </a>

        <!-- WhatsApp confirm button -->
        <button id="waBtn"
                class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-semibold text-sm p-3 rounded-xl">
          Confirm on WhatsApp
        </button>

        <!-- WhatsApp backup link (visible text) -->
        <a id="waLink"
           href="#"
           target="_blank"
           class="mt-1 block text-center text-emerald-700 underline text-[11px] break-all">
        </a>

        <div class="mt-4 bg-green-500 text-white p-3 rounded-xl text-xs">
          <b>IMPORTANT:</b> After payment, tap ‚ÄúConfirm on WhatsApp‚Äù and send the
          payment screenshot so we can process your order.
        </div>
      </div>
    </section>

    <footer class="p-4 border-t border-gray-200 text-xs text-gray-500 flex justify-between">
      <span>¬© <span id="year"></span> Customised Jewellary</span>
      <span>We never ask for OTP / PIN</span>
    </footer>

  </main>

<script>
  // ---------------- CONFIG ----------------
  const UPI_ID       = "Aroobakhan660@okicici";
  const PAYEE_NAME   = "Customised Jewellary";

  // üëá CHANGE THIS TO YOUR REAL WHATSAPP NUMBER
  // Format: countrycode + number, NO plus sign, NO spaces
  // For example: India 98765xxxxx  => "9198765xxxxx"
  const WHATSAPP_NUMBER = "919876543210";  // ‚Üê REPLACE THIS

  // ---------------- DOM ----------------
  const prodNameEl   = document.getElementById("prodName");
  const prodPriceEl  = document.getElementById("prodPrice");
  const amountNoteEl = document.getElementById("amountNote");
  const copyBtn      = document.getElementById("copyBtn");
  const upiDisplay   = document.getElementById("upiDisplay");
  const payBtn       = document.getElementById("payBtn");
  const upiLinkEl    = document.getElementById("upiLink");
  const waBtn        = document.getElementById("waBtn");
  const waLinkEl     = document.getElementById("waLink");

  document.getElementById("year").textContent = new Date().getFullYear();
  upiDisplay.textContent = UPI_ID;

  // ---------------- URL PARAMS ----------------
  const qs = new URLSearchParams(location.search);

  const product = qs.get("product") || "Customised Order";
  const price   = qs.get("price")   || "";
  const qtyRaw  = qs.get("qty")     || "1";

  const qty   = parseInt(qtyRaw) || 1;
  const num   = price ? parseFloat(price) : 0;
  const total = qty * num;

  let amountStr = "";
  prodNameEl.textContent = product;

  if (total > 0) {
    amountStr = total.toFixed(2);
    prodPriceEl.textContent = "‚Çπ" + amountStr;
    if (qty > 1) {
      amountNoteEl.textContent = (${qty} √ó ‚Çπ${num.toFixed(2)});
    }
  } else {
    prodPriceEl.textContent = "Amount not set";
    amountNoteEl.textContent = "Go back and choose product again so amount is added.";
    payBtn.disabled = true;
    payBtn.classList.add("opacity-60", "cursor-not-allowed");
  }

  // ---------------- MINIMAL UPI LINK ----------------
  function buildUpiUrl() {
    const p = new URLSearchParams();
    p.append("pa", UPI_ID);       // payee VPA
    p.append("pn", PAYEE_NAME);   // payee name
    p.append("am", amountStr);    // amount
    p.append("cu", "INR");        // currency

    return "upi://pay?" + p.toString();
  }

  let upiUrl = "";
  if (amountStr) {
    upiUrl = buildUpiUrl();
    upiLinkEl.href = upiUrl;
    upiLinkEl.textContent =
      "If the button does not work, tap this UPI link: " + upiUrl;
  } else {
    upiLinkEl.textContent = "UPI link will appear here when amount is set.";
  }

  // ---------------- WHATSAPP LINK ----------------
  function buildWhatsappUrl() {
    // fallback text if no amount
    const displayAmount = amountStr ? ‚Çπ${amountStr} : "(amount not auto-filled)";
    const msg =
      `Hello, I have completed a payment for "${product}" of ${displayAmount} ` +
      via UPI ID ${UPI_ID}. I am attaching the payment screenshot.;

    const encoded = encodeURIComponent(msg);
    return https://wa.me/${WHATSAPP_NUMBER}?text=${encoded};
  }

  const whatsappUrl = buildWhatsappUrl();
  waLinkEl.href = whatsappUrl;
  waLinkEl.textContent = "Or tap here if the WhatsApp button does not open: " + whatsappUrl;

  // ---------------- COPY UPI ID ----------------
  copyBtn.addEventListener("click", () => {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(UPI_ID)
        .then(() => alert("UPI ID copied: " + UPI_ID))
        .catch(() => alert("Copy failed, please copy manually."));
    } else {
      alert("Copy not supported, please copy manually: " + UPI_ID);
    }
  });

  // ---------------- PAY BUTTON ----------------
  payBtn.addEventListener("click", () => {
    if (!amountStr) {
      alert("Amount is missing. Please go back and select the product again.");
      return;
    }

    if (!upiUrl) {
      alert("Something went wrong building the UPI link. Please refresh and try again.");
      return;
    }

    window.location.href = upiUrl;  // SIMPLEST POSSIBLE
  });

  // ---------------- WHATSAPP BUTTON ----------------
  waBtn.addEventListener("click", () => {
    if (!WHATSAPP_NUMBER || WHATSAPP_NUMBER === "919876543210") {
      alert("WhatsApp number not configured. Edit the code and set WHATSAPP_NUMBER.");
      return;
    }
    window.open(whatsappUrl, "_blank");
  });
</script>

</body>
<!-- BUY BUTTON (insert just before </body>) -->
<button id="buyNow">Buy Now</button>

<script>
const BACKEND = "https://upi-checkout-backend.onrender.com";

// If your page already has a Buy/Add button, set its id to 'buyNow' or change selector below.
document.getElementById('buyNow').addEventListener('click', async () => {
  try {
    // Change productId to match the real product you want to sell (ring-001, necklace-001, etc.)
    const payload = { productId: "ring-001", qty: 1 };

    const res = await fetch(BACKEND + "/create-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const j = await res.json();
    if (!res.ok) throw new Error(j.error || "Order creation failed");

    // Redirect the user to the backend-hosted checkout page
    window.location.href = `${BACKEND}/checkout.html?orderId=${encodeURIComponent(j.orderId)}`;

  } catch (err) {
    alert("Error: " + err.message);
  }
});
</script>
<!-- end buy snippet -->

</html>